{
  "hash": "048dd476f28b580e6fcd481baf099498",
  "result": {
    "markdown": "---\ntitle: \"Regression Discontinuity\"\n---\n\n\n# Assignment\n\n*  For the first assignment, use the data from the just discussed application (coupon.rds). When conducting a regression discontinuity design, one parameter that is chosen somehow arbitrarily is the bandwidth. Check how sensitive the result is to changing the bandwidth by running the analysis\n\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-1_f4d781f99d8354686e34a67aa34a25dc'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\nlibrary(rddensity)\n\ncoupon <- readRDS(\"D:/GitHub/cdsba-pamoviedo/Causal_Data_Science_Data/coupon.rds\")\n\n#define cut-off\nc0 <- 60\n\n# Define bandwidths\nbw <- c0 + c(-5, 5) \nbw_1 <- c0 + c(-2.5,2,5) # Half BW\nbw_2 <- c0 + c(-10,10)   # Double BW\n\n# Normal Bandwidth:\n# Subsets below and above threshold in specified bandwidth\ndf_bw_below <- coupon %>% filter(days_since_last >= bw[1] & days_since_last < c0)\ndf_bw_above <- coupon %>% filter(days_since_last >= c0 & days_since_last <= bw[2])\n\ndf_bw <- bind_rows(df_bw_above, df_bw_below)\n\nlm_bw <- lm(purchase_after ~ days_since_last_centered + coupon, df_bw)\nsummary(lm_bw)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_after ~ days_since_last_centered + coupon, \n#>     data = df_bw)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -11.4966  -2.1312  -0.0949   2.0185  10.4159 \n#> \n#> Coefficients:\n#>                          Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)               11.4242     0.3965  28.813  < 2e-16 ***\n#> days_since_last_centered   0.3835     0.1259   3.046  0.00251 ** \n#> couponTRUE                 7.9334     0.7087  11.194  < 2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 3.186 on 320 degrees of freedom\n#> Multiple R-squared:  0.7074,\tAdjusted R-squared:  0.7055 \n#> F-statistic: 386.8 on 2 and 320 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n\n###  With half the bandwidth\n\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-2_a69a719d25f662ea93c822ec033d0894'}\n\n```{.r .cell-code}\n# Case of Half the bandwidth\ndf_bw_below_1 <- coupon %>% filter(days_since_last >= bw_1[1] & days_since_last < c0)\ndf_bw_above_1 <- coupon %>% filter(days_since_last >= c0 & days_since_last <= bw_1[2])\n\ndf_bw_1 <- bind_rows(df_bw_above_1, df_bw_below_1)\n\nlm_bw_1 <- lm(purchase_after ~ days_since_last_centered + coupon, df_bw_1)\nsummary(lm_bw_1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_after ~ days_since_last_centered + coupon, \n#>     data = df_bw_1)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -10.9756  -2.1067  -0.0376   2.0936   8.0708 \n#> \n#> Coefficients:\n#>                          Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)               11.3543     0.6438  17.636  < 2e-16 ***\n#> days_since_last_centered   0.4740     0.3774   1.256    0.211    \n#> couponTRUE                 7.4823     1.0771   6.947 9.38e-11 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 3.352 on 157 degrees of freedom\n#> Multiple R-squared:  0.6255,\tAdjusted R-squared:  0.6208 \n#> F-statistic: 131.1 on 2 and 157 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n\n###  With double the bandwidth\n\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-3_ecab72b37cc9a6c9fbd8a2d44a447400'}\n\n```{.r .cell-code}\n# Case of Double the bandwidth\ndf_bw_below_2 <- coupon %>% filter(days_since_last >= bw_2[1] & days_since_last < c0)\ndf_bw_above_2 <- coupon %>% filter(days_since_last >= c0 & days_since_last <= bw_2[2])\n\ndf_bw_2 <- bind_rows(df_bw_above_2, df_bw_below_2)\n\nlm_bw_2 <- lm(purchase_after ~ days_since_last_centered + coupon, df_bw_2)\nsummary(lm_bw_2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_after ~ days_since_last_centered + coupon, \n#>     data = df_bw_2)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -12.2718  -2.0858  -0.0003   2.0275  10.6749 \n#> \n#> Coefficients:\n#>                          Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)              10.61700    0.27386  38.767   <2e-16 ***\n#> days_since_last_centered  0.01413    0.04255   0.332     0.74    \n#> couponTRUE                9.51584    0.48628  19.569   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 3.115 on 626 degrees of freedom\n#> Multiple R-squared:  0.7052,\tAdjusted R-squared:  0.7042 \n#> F-statistic: 748.6 on 2 and 626 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n\n*  Comparing the results from normal, half and double the band width we can see that changing the value from the normal to half the change in the estimate coefficients remain almost unchanged but when the band width is doubled we can see the change. It is important to choose the correct value according to what the ask is.\n\n#  \n*  Now consider a different past campaign. For a limited amount of time, for purchases with a total amount of more than 30€ you offered free shipping. The data can be seen in shipping.rds. Have a look at the variable purchase_amount and argue whether it could generally be used as a running variable with a cut-off at 30€.\n\n## Use a plot to confirm your argument.\n\n\n::: {.cell hash='10_rdd_cache/html/unnamed-chunk-4_3dab5d234bcf4d98e0e531d91f6bb406'}\n\n```{.r .cell-code}\nlibrary(rddensity)\nlibrary(tidyverse)\n\nShipping <- readRDS(\"D:/GitHub/cdsba-pamoviedo/Causal_Data_Science_Data/shipping.rds\")\n\n#Define cut-off\nco <- 30\n\n#Density Test\nrddd <- rddensity(Shipping$purchase_amount, c = co)\nsummary(rddd)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Manipulation testing using local polynomial density estimation.\n#> \n#> Number of obs =       6666\n#> Model =               unrestricted\n#> Kernel =              triangular\n#> BW method =           estimated\n#> VCE method =          jackknife\n#> \n#> c = 30                Left of c           Right of c          \n#> Number of obs         3088                3578                \n#> Eff. Number of obs    2221                1955                \n#> Order est. (p)        2                   2                   \n#> Order bias (q)        3                   3                   \n#> BW est. (h)           22.909              20.394              \n#> \n#> Method                T                   P > |T|             \n#> Robust                5.9855              0\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> Warning in summary.CJMrddensity(rddd): There are repeated observations. Point\n#> estimates and standard errors have been adjusted. Use option massPoints=FALSE\n#> to suppress this feature.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> P-values of binomial tests (H0: p=0.5).\n#> \n#> Window Length / 2          <c     >=c    P>|T|\n#> 0.261                      20      26    0.4614\n#> 0.522                      41      65    0.0250\n#> 0.783                      62     107    0.0007\n#> 1.043                      81     136    0.0002\n#> 1.304                     100     169    0.0000\n#> 1.565                     114     196    0.0000\n#> 1.826                     132     227    0.0000\n#> 2.087                     156     263    0.0000\n#> 2.348                     173     298    0.0000\n#> 2.609                     191     331    0.0000\n```\n:::\n\n```{.r .cell-code}\n#Visual check\nrdd_plot <- rdplotdensity(rddd, Shipping$purchase_amount, plotN = 100)\n```\n\n::: {.cell-output-display}\n![](10_rdd_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n*  P-value is 0 which would indicate there is a statistically significant difference at the cutoff. That supports the idea that purchases with amounts greater than 30€ have a different impact than those at or below 30€. (Since shipping is free for those orders above 30€). Taking this into consideration we can use purchase amount as a running variable. ",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}