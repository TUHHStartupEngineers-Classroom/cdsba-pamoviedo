{
  "hash": "4aaa78f1f25645bb50da201a8fe9fe1b",
  "result": {
    "markdown": "---\ntitle: \"Randomized Controlled Trials\"\n---\n\n# After loading the data, perform the following steps:\n\n## Check whether the covariates are balanced across the groups. Use a plot to show it.\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-1_f7e28b34186cc0c5df71d4d95a1760f0'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggplot2)\n\n# Load the dataset\nabtest_data <-  readRDS(\"D:/GitHub/cdsba-pamoviedo/Causal_Data_Science_Data/abtest_online.rds\")\nlm_ate <-lm(purchase_amount ~ chatbot, data= abtest_data)\nsummary(lm_ate)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_amount ~ chatbot, data = abtest_data)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -16.702 -14.478  -9.626  13.922  64.648 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)  16.7017     0.8374  19.944  < 2e-16 ***\n#> chatbotTRUE  -7.0756     1.1796  -5.998 2.79e-09 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 18.65 on 998 degrees of freedom\n#> Multiple R-squared:  0.0348,\tAdjusted R-squared:  0.03383 \n#> F-statistic: 35.98 on 1 and 998 DF,  p-value: 2.787e-09\n```\n:::\n\n```{.r .cell-code}\ncompare_prev <- ggplot(abtest_data,\n                       aes(x=chatbot,\n                           y=previous_visit,\n                           color = as.factor(chatbot)))  + \n  stat_summary(geom = \"errorbar\", \n               width = .5,\n               fun.data = \"mean_se\", \n               fun.args = list(mult=1.96),\n               show.legend = F) +\n  labs(x = NULL, y = \"Previous_visits\", title = \"Difference in previous visits\")\n\n\ncompare_mobile <- ggplot(abtest_data,\n                         aes(x=chatbot,\n                             y=mobile_device,\n                             color = as.factor(chatbot)))  + \n  stat_summary(geom = \"errorbar\", \n               width = .5,\n               fun.data = \"mean_se\", \n               fun.args = list(mult=1.96),\n               show.legend = F) +\n  labs(x = NULL, y = \"Mobile decives\", title = \"Difference in mobile devices\")\n\n\ncompare_outcome <-  ggplot(abtest_data, \n                           aes(x = chatbot, \n                               y = purchase_amount, \n                               color = as.factor(chatbot))) +\n  stat_summary(geom = \"errorbar\", \n               width = .5,\n               fun.data = \"mean_se\", \n               fun.args = list(mult=1.96),\n               show.legend = F) +\n  labs(x = NULL, y = \"Purchase Amount\", title = \"Difference in Purchase Amount\")\n\nplot(compare_prev)\n```\n\n::: {.cell-output-display}\n![](06_rct_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n\n```{.r .cell-code}\nplot (compare_mobile) \n```\n\n::: {.cell-output-display}\n![](06_rct_files/figure-html/unnamed-chunk-1-2.png){width=672}\n:::\n\n```{.r .cell-code}\nplot(compare_outcome)\n```\n\n::: {.cell-output-display}\n![](06_rct_files/figure-html/unnamed-chunk-1-3.png){width=672}\n:::\n:::\n\n\n*  Covariates are not balanced in the plots. \n\n## Run a regression to find the effect of chatbot on sales.\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-2_62c61b4a15829247fb192fdc040b88a5'}\n\n```{.r .cell-code}\nlm_all <- lm(purchase_amount~chatbot+previous_visit+mobile_device, data=abtest_data)\nsummary(lm_all)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_amount ~ chatbot + previous_visit + mobile_device, \n#>     data = abtest_data)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -25.414 -14.428  -8.435  12.559  64.584 \n#> \n#> Coefficients:\n#>                   Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)        15.2840     1.1227  13.614  < 2e-16 ***\n#> chatbotTRUE        -6.8488     1.1792  -5.808 8.49e-09 ***\n#> previous_visit      0.7792     0.2869   2.716  0.00673 ** \n#> mobile_deviceTRUE  -0.8562     1.2642  -0.677  0.49841    \n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 18.6 on 996 degrees of freedom\n#> Multiple R-squared:  0.04243,\tAdjusted R-squared:  0.03954 \n#> F-statistic: 14.71 on 3 and 996 DF,  p-value: 2.228e-09\n```\n:::\n:::\n\n\n*  We can see that the chatbot coefficient is negative and it has a small p value which would suggest that the chatbot is associated with a statistically significant decrease in the average purchase. Customers with the chatbot tend to make smaller purchases compared to those with human interaction. \n\n## Find subgroup-specific effects by including an interaction. Compute a CATE for one exemplary group. A subgroup could be for example mobile users.\n\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-3_25f15fecd25e6fb39fddb5dcad635164'}\n\n```{.r .cell-code}\n# Include an interaction term\nlm_model <- lm(purchase_amount ~ chatbot * mobile_device, data = abtest_data)\nsummary(lm_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = purchase_amount ~ chatbot * mobile_device, data = abtest_data)\n#> \n#> Residuals:\n#>    Min     1Q Median     3Q    Max \n#> -16.98 -14.54  -9.95  14.13  65.24 \n#> \n#> Coefficients:\n#>                               Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)                    16.9797     1.0152  16.725   <2e-16 ***\n#> chatbotTRUE                    -7.0301     1.4284  -4.922    1e-06 ***\n#> mobile_deviceTRUE              -0.8727     1.7987  -0.485    0.628    \n#> chatbotTRUE:mobile_deviceTRUE  -0.1526     2.5369  -0.060    0.952    \n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 18.66 on 996 degrees of freedom\n#> Multiple R-squared:  0.03534,\tAdjusted R-squared:  0.03244 \n#> F-statistic: 12.16 on 3 and 996 DF,  p-value: 8.034e-08\n```\n:::\n:::\n\n\n*  As we can see from the summary, both the estimate and p value show us that the interaction between chatbot and mobile users has no statistically significant effect on making a purchase. \n\n\n## Itâ€™s not only of interest how much customers buy but also if the buy at all. Then, the dependent variable is binary (either 0 or 1) instead of continuous and the model of choice is the logistic regression. Use the outcome variable purchase and run a logistic regression. The coefficients are not as easily interpretable as before. Look it up and interpret the coefficient for chatbot.\n\n::: {.cell hash='06_rct_cache/html/unnamed-chunk-4_5ce888453ed8e08f8357aa651a39285e'}\n\n```{.r .cell-code}\n#Logistic regression\nlogistic_model <- glm(purchase ~ chatbot + mobile_device + previous_visit, \n                      data = abtest_data, \n                      family = binomial(link = 'logit'))\nsummary(logistic_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> glm(formula = purchase ~ chatbot + mobile_device + previous_visit, \n#>     family = binomial(link = \"logit\"), data = abtest_data)\n#> \n#> Coefficients:\n#>                   Estimate Std. Error z value Pr(>|z|)    \n#> (Intercept)       -0.22185    0.12347  -1.797  0.07237 .  \n#> chatbotTRUE       -0.96894    0.13564  -7.144 9.09e-13 ***\n#> mobile_deviceTRUE -0.07119    0.14530  -0.490  0.62417    \n#> previous_visit     0.10606    0.03262   3.252  0.00115 ** \n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> (Dispersion parameter for binomial family taken to be 1)\n#> \n#>     Null deviance: 1329.1  on 999  degrees of freedom\n#> Residual deviance: 1262.2  on 996  degrees of freedom\n#> AIC: 1270.2\n#> \n#> Number of Fisher Scoring iterations: 4\n```\n:::\n\n```{.r .cell-code}\n# Extract coefficient for chatbot\nchatbot_coefficient <- coef(logistic_model)[\"chatbotTRUE\"]\n# Calculate odds ratio\nodds_ratio <- exp(chatbot_coefficient)\n```\n:::\n\n\n*  The coefficient for chatbot in the logistic model is -0.969 which means that for users that are exposed to the chatbot, the odds of making a purchase decrease by 0.969 units compared to those not exposed to it. If we exponentiate the coefficient will give us the odds ratio of 0.379 which tells us that the odds of making a purchase for users exposed to the chatbot are 0.379 times the odds for the users with human interaction.  \n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}